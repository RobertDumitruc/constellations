<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonic Constellations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000010;
            color: #EAEAEA;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        #constellation-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
        }

        .content-overlay {
            position: relative;
            z-index: 2;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            pointer-events: none; /* Allow clicks to pass through to the canvas */
        }
        
        /* Re-enable pointer events for interactive UI elements within the overlay */
        .content-overlay header, .content-overlay nav {
            pointer-events: auto;
        }
        
        /* Glass morphism effect for the info panel */
        .info-panel {
            background: rgba(10, 10, 25, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
            transform: translateX(110%);
        }

        .info-panel.active {
            transform: translateX(0);
        }

        /* Custom scrollbar for info panel */
        .info-panel-content::-webkit-scrollbar {
            width: 6px;
        }
        .info-panel-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .info-panel-content::-webkit-scrollbar-thumb {
            background-color: rgba(0, 200, 255, 0.3);
            border-radius: 10px;
            border: 3px solid transparent;
        }
        
        .nav-button {
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 200, 255, 0.3);
        }
        .nav-button:hover, .nav-button.active {
            background-color: rgba(0, 200, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 200, 255, 0.5);
            transform: translateY(-2px);
        }
        
        /* Hide the YouTube player */
        #youtube-player {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
        }
    </style>
</head>
<body class="antialiased">

    <div id="audio-start-overlay" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center text-center p-4 transition-opacity duration-500">
        <div>
            <h2 id="loading-text" class="text-3xl font-bold text-white mb-4">Welcome to Sonic Constellations</h2>
            <p id="loading-subtext" class="text-lg text-gray-300 mb-8">Click to enable audio and begin your exploration.</p>
            <button id="start-audio-btn" class="bg-cyan-500 text-black font-bold py-3 px-8 rounded-full text-lg hover:bg-cyan-400 transition-transform hover:scale-105">Enter</button>
        </div>
    </div>

    <canvas id="constellation-canvas"></canvas>

    <div class="content-overlay">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold tracking-wider text-white">Sonic Constellations</h1>
            <p class="text-lg md:text-xl text-cyan-200 mt-2">Exploring the invisible lines connecting music through time.</p>
        </header>

        <!-- Navigation -->
        <nav id="constellation-nav" class="flex flex-wrap justify-center gap-3 mb-8">
            <!-- Navigation buttons will be injected by JS -->
        </nav>

        <!-- Main interactive area for pointer events -->
        <main class="flex-grow w-full">
            <!-- The canvas is in the background, this area is just for capturing events -->
        </main>
    </div>

    <!-- Song Info Panel -->
    <aside id="info-panel" class="info-panel fixed top-0 right-0 h-full w-full max-w-sm p-6 rounded-l-2xl shadow-2xl">
        <button id="close-panel" class="absolute top-4 right-4 text-gray-300 hover:text-white transition-colors">&times;</button>
        <div id="info-panel-content" class="h-full overflow-y-auto pr-2">
            <h2 id="song-title" class="text-3xl font-bold text-cyan-300 mb-2"></h2>
            <p id="song-artist" class="text-xl text-white mb-4"></p>
            <p id="song-year" class="text-md text-gray-400 mb-6"></p>
            <div class="border-t border-cyan-500/20 pt-4">
                <h3 class="text-lg font-semibold text-gray-200 mb-2">The Connection</h3>
                <p id="song-sample" class="text-gray-300 italic bg-black/20 p-4 rounded-lg"></p>
            </div>
            <div id="source-info" class="mt-6 border-t border-cyan-500/20 pt-4">
                 <h3 class="text-lg font-semibold text-gray-200 mb-2">Source Sample From</h3>
                 <p id="source-song" class="text-gray-300"></p>
            </div>
        </div>
    </aside>

    <!-- YouTube player will be injected here -->
    <div id="youtube-player"></div>

    <script>
        const canvas = document.getElementById('constellation-canvas');
        const ctx = canvas.getContext('2d');

        const infoPanel = document.getElementById('info-panel');
        const closePanelBtn = document.getElementById('close-panel');
        
        let stars = [];
        let hoveredStar = null;
        let lastHoveredStarId = null;
        let activeConstellation = null;
        let ytPlayer;
        let snippetTimeout;
        let isYTAPiReady = false;

        // --- DATA: Define the constellations with sound ---
        const constellations = {
            "Amen Break": {
                name: "The 'Amen Break'",
                stars: [
                    { id: 1, title: "Amen, Brother", artist: "The Winstons", year: 1969, x: 0.5, y: 0.5, isSource: true, sample: "The foundational 6-second drum solo.", sound: { videoId: 'GxZuq57_bYM', startTime: 86, endTime: 92 } },
                    { id: 2, title: "Straight Outta Compton", artist: "N.W.A.", year: 1988, x: 0.3, y: 0.35, sample: "The iconic drum loop provides the track's backbone.", sound: { videoId: '33jyoyJNa2c', startTime: 4, endTime: 8 } },
                    { id: 3, title: "King of the Beats", artist: "Mantronix", year: 1988, x: 0.7, y: 0.25, sample: "One of the earliest hip-hop tracks to popularize the break.", sound: { videoId: 'WzgODI4osy4', startTime: 19, endTime: 23 } },
                    { id: 4, title: "I Desire", artist: "Salt-N-Pepa", year: 1986, x: 0.65, y: 0.7, sample: "The break is pitched up and sped up, giving the track its energy.", sound: { videoId: 'oJ3yleK136k', startTime: 11, endTime: 15 } },
                    { id: 5, title: "Pigs", artist: "Tyler, The Creator", year: 2013, x: 0.35, y: 0.8, sample: "A modern usage, showing the break's timeless appeal in pop music.", sound: { videoId: 'gmr4iZ5dimY', startTime: 0, endTime: 10 } }
                ]
            },
            "Funky Drummer": {
                name: "The 'Funky Drummer'",
                stars: [
                    { id: 1, title: "Funky Drummer", artist: "James Brown", year: 1970, x: 0.5, y: 0.5, isSource: true, sample: "Clyde Stubblefield's legendary drum break.", sound: { videoId: 'dNPaf2D3TSE', startTime: 326, endTime: 331 } },
                    { id: 2, title: "Rebel Without a Pause", artist: "Public Enemy", year: 1987, x: 0.25, y: 0.6, sample: "The break is chopped and layered to create a chaotic, energetic rhythm.", sound: { videoId: '21sK74_prJA', startTime: 53, endTime: 57 } },
                    { id: 3, title: "Freedom! '90", artist: "George Michael", year: 1990, x: 0.7, y: 0.7, sample: "A clean loop of the break drives this pop anthem.", sound: { videoId: 'diYAc7gB-0A', startTime: 0, endTime: 5 } },
                    { id: 4, title: "Let Me Ride", artist: "Dr. Dre", year: 1992, x: 0.3, y: 0.3, sample: "The break forms the core of this G-funk classic.", sound: { videoId: '3-S2s_x2vjU', startTime: 32, endTime: 36 } },
                    { id: 5, title: "Run's House", artist: "Run-DMC", year: 1988, x: 0.75, y: 0.35, sample: "The unmistakable groove powers this hip-hop staple.", sound: { videoId: '22gGAY82A6A', startTime: 0, endTime: 4 } }
                ]
            }
        };

        // --- YOUTUBE PLAYER SETUP ---
        function onYouTubeIframeAPIReady() {
            // This function is called automatically by the YouTube script.
            // It just signals that the API is ready to be used.
            isYTAPiReady = true;
        }

        function playSnippet(star) {
            if (!ytPlayer || !star.sound || typeof ytPlayer.loadVideoById !== 'function') return;

            clearTimeout(snippetTimeout);
            
            const { videoId, startTime, endTime } = star.sound;
            const duration = (endTime - startTime) * 1000;

            ytPlayer.loadVideoById({
                videoId: videoId,
                startSeconds: startTime,
                endSeconds: endTime
            });

            snippetTimeout = setTimeout(() => {
                if (ytPlayer && typeof ytPlayer.pauseVideo === 'function') {
                    ytPlayer.pauseVideo();
                }
            }, duration);
        }

        // --- SETUP & SIZING ---
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            draw();
        }

        // --- DRAWING FUNCTIONS ---
        function drawStar(star) {
            const x = star.x * canvas.width;
            const y = star.y * canvas.height;
            const radius = star.isSource ? 12 : 6;
            const isHovered = hoveredStar && hoveredStar.id === star.id;
            
            ctx.beginPath();
            ctx.arc(x, y, isHovered ? radius * 1.5 : radius, 0, Math.PI * 2);
            
            ctx.shadowColor = star.isSource ? 'rgba(255, 255, 180, 0.9)' : 'rgba(0, 255, 255, 0.7)';
            ctx.shadowBlur = isHovered ? 30 : 15;
            
            ctx.fillStyle = star.isSource ? 'rgba(255, 255, 220, 1)' : 'rgba(200, 255, 255, 1)';
            ctx.fill();
            ctx.closePath();

            ctx.shadowBlur = 0;
        }

        function drawLines(constellation) {
            const sourceStar = constellation.stars.find(s => s.isSource);
            if (!sourceStar) return;
            const sx = sourceStar.x * canvas.width;
            const sy = sourceStar.y * canvas.height;

            constellation.stars.forEach(star => {
                if (!star.isSource) {
                    const ex = star.x * canvas.width;
                    const ey = star.y * canvas.height;

                    ctx.beginPath();
                    ctx.moveTo(sx, sy);
                    ctx.lineTo(ex, ey);
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    ctx.closePath();
                    
                    ctx.save();
                    let angle = Math.atan2(ey - sy, ex - sx);
                    if (ex < sx) {
                        angle += Math.PI;
                    }
                    ctx.translate((sx + ex) / 2, (sy + ey) / 2);
                    ctx.rotate(angle);
                    ctx.textAlign = 'center';
                    ctx.fillStyle = 'rgba(0, 255, 255, 0.4)';
                    ctx.font = '12px Inter';
                    ctx.fillText(`— from '${sourceStar.title}'`, 0, -5);
                    ctx.restore();
                }
            });
        }
        
        function drawHoveredStarTitle() {
            if (hoveredStar) {
                const x = hoveredStar.x * canvas.width;
                const y = hoveredStar.y * canvas.height;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.font = '14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(hoveredStar.title, x, y - 25);
            }
        }

        function createBackgroundStars() {
            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: Math.random(),
                    y: Math.random(),
                    radius: Math.random() * 1.5,
                    alpha: Math.random() * 0.5 + 0.2,
                    velocity: Math.random() * 0.1 + 0.05
                });
            }
        }

        function drawBackground() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(star => {
                star.y -= star.velocity / 1000;
                if (star.y < 0) star.y = 1;

                ctx.beginPath();
                ctx.arc(star.x * canvas.width, star.y * canvas.height, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
                ctx.fill();
            });
        }


        function draw() {
            drawBackground();
            if (activeConstellation) {
                drawLines(activeConstellation);
                activeConstellation.stars.forEach(drawStar);
                drawHoveredStarTitle();
            }
        }
        
        function animate() {
            draw();
            requestAnimationFrame(animate);
        }
        
        function getStarAtPos(x, y) {
            if (!activeConstellation) return null;

            for (const star of activeConstellation.stars) {
                const starX = star.x * canvas.width;
                const starY = star.y * canvas.height;
                const radius = star.isSource ? 12 : 6;
                const distance = Math.sqrt((starX - x) ** 2 + (starY - y) ** 2);
                if (distance < radius * 2) {
                    return star;
                }
            }
            return null;
        }

        canvas.addEventListener('mousemove', (e) => {
            if (!ytPlayer) return;

            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const star = getStarAtPos(mouseX, mouseY);
            
            if (star) {
                canvas.style.cursor = 'pointer';
                hoveredStar = star;
                if (star.id !== lastHoveredStarId) {
                    playSnippet(star);
                    lastHoveredStarId = star.id;
                }
            } else {
                canvas.style.cursor = 'default';
                hoveredStar = null;
                if(lastHoveredStarId !== null) {
                    if (ytPlayer && typeof ytPlayer.pauseVideo === 'function') {
                        ytPlayer.pauseVideo();
                    }
                    clearTimeout(snippetTimeout);
                    lastHoveredStarId = null;
                }
            }
        });

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const star = getStarAtPos(mouseX, mouseY);
            if (star) {
                updateInfoPanel(star);
                infoPanel.classList.add('active');
            }
        });

        closePanelBtn.addEventListener('click', () => {
            infoPanel.classList.remove('active');
        });

        function updateInfoPanel(star) {
            document.getElementById('song-title').textContent = star.title;
            document.getElementById('song-artist').textContent = star.artist;
            document.getElementById('song-year').textContent = `Released: ${star.year}`;
            document.getElementById('song-sample').textContent = star.sample;
            
            const sourceInfoDiv = document.getElementById('source-info');
            if (star.isSource) {
                 sourceInfoDiv.style.display = 'none';
            } else {
                const source = activeConstellation.stars.find(s => s.isSource);
                document.getElementById('source-song').textContent = `${source.title} by ${source.artist} (${source.year})`;
                sourceInfoDiv.style.display = 'block';
            }
        }

        function loadConstellation(key) {
            activeConstellation = constellations[key];
            infoPanel.classList.remove('active');
            
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.key === key);
            });
        }
        
        function initNav() {
            const navContainer = document.getElementById('constellation-nav');
            Object.keys(constellations).forEach(key => {
                const button = document.createElement('button');
                button.textContent = constellations[key].name;
                button.dataset.key = key;
                button.className = 'nav-button bg-black/20 text-cyan-200 py-2 px-4 rounded-full text-sm backdrop-blur-sm';
                button.addEventListener('click', () => loadConstellation(key));
                navContainer.appendChild(button);
            });
        }

        function initAudio() {
            const startBtn = document.getElementById('start-audio-btn');
            const overlay = document.getElementById('audio-start-overlay');
            const loadingText = document.getElementById('loading-text');
            const loadingSubtext = document.getElementById('loading-subtext');
            
            startBtn.addEventListener('click', () => {
                if (!isYTAPiReady) {
                    loadingSubtext.textContent = 'API is still loading, please wait a second...';
                    setTimeout(() => { startBtn.click() }, 1000); // Retry after 1s
                    return;
                }

                loadingText.textContent = 'Initializing Player...';
                loadingSubtext.textContent = 'Please wait a moment.';
                startBtn.style.display = 'none';

                // Create the player inside the user click event to satisfy autoplay policies
                ytPlayer = new YT.Player('youtube-player', {
                    height: '1',
                    width: '1',
                    playerVars: {
                        'autoplay': 1,
                        'controls': 0
                    },
                    events: {
                        'onReady': () => {
                            console.log('YouTube Player is ready.');
                            overlay.style.opacity = '0';
                            setTimeout(() => overlay.style.display = 'none', 500);
                        },
                        'onError': (error) => {
                            console.error('YouTube Player Error:', error);
                            loadingText.textContent = 'Error Initializing Player';
                            loadingSubtext.textContent = 'Please check the console and refresh.';
                        }
                    }
                });
            }, { once: true });
        }

        // --- INITIALIZATION ---
        window.addEventListener('resize', resizeCanvas);

        document.addEventListener('DOMContentLoaded', () => {
            initNav();
            initAudio();
            createBackgroundStars();
            resizeCanvas();
            animate();
            
            const firstKey = Object.keys(constellations)[0];
            if(firstKey) {
                loadConstellation(firstKey);
            }
        });

    </script>
    <!-- Load the YouTube Iframe API -->
    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>

